---
date: "11/4/2019"
output:
  html_document:
    toc: true
    toc_depth: 3
    toc_float: true
    toc_smooth_scroll: TRUE
    code_folding:  hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
                           echo = TRUE,
                        message = FALSE,
                        warning = FALSE,
                  code_download = TRUE,
                          cache = TRUE,
                      #fig.width = 12, 
                     fig.height = 6, 
                        fig.asp = 0.618,
                     fig.align  = "center",
                    fig_caption = TRUE,
                     #out.width = "70%"
                      out.width = "600px", 
                     out.height = "420px",
                       fig.path = "fig/",
                          tidy = TRUE
                     )
```

In this space, I will be sharing  my thought on data and data science related subjects that I find interesting and educational. If I find, what I consider to be a good articles from other data enthusiasts and practitioners, I will  find space for theme here. 

# Blog_1 - Data Driven Decision
**_11/04/2019_**  
<br>
<p>
<img src="fig/geom_variety_final.png" align="left" width="25%" height="35%" style="margin-right: 8px;"/>
Selecting a topic for what I wanted to discuss on the first blog for dataRecode.com was harder than I thought. At the end, I wanted to pay homage to the **mtcars** dataset, from 1974 Motor Trend US magazine. A dataset that is frequently used in the data science community to illustrate data analysis concepts. I have used mtcars dataset quite a bit to test  tidying, transforming, visualizing, modeling and even machine learning over the years. <br>
<a class="btn btn-info" data-toggle="collapse" href="#collapseExample_1" aria-expanded="false" aria-controls="collapseExample_1">
    Read More
  </a>
</p>
<div class="collapse" id="collapseExample_1">
  <div class="card card-block">

Depending on the the question you want answered, and the data type you have on hand, there are many workflow models to choose from when analyzing a data. A typical data analysis model follows a framework similar to what you see on Fig \@ref(fig:workflow).

<div class="alert alert-dismissible alert-primary">
  <button type="button" class="close" data-dismiss="alert">&times;</button>
  <strong>Oh snap!</strong> <a href="#" class="alert-link">Change a few things up</a> and try submitting again.
</div>

```{r workflow, out.width = "50%", fig_caption = TRUE,fig.cap="Fig 1: Data science workflow from Harvard University Data Science Course"}
knitr::include_graphics("fig/DataScienceProcess.png")
```

Without further ado, lets get started with the analysis.  

## Formualting the Question
The first order of business before starting any analysis is to prepare a set of questions we want to ask our data. The questions should be as detailed as possible, because generic questions tend to not yield actionable responses.  In practice, more questions arise once we start digging into the data and know more about what other hidden answers can be extracted. For this blog analysis of mtcars dataset, we will limit the number of question to  three for brevity.

**Let us set a scenario to help frame the questions:**  
Suppose you want to purchase a vehicle and walk onto a used car sales lot that has 32 used cars.  Each car has its own features such as gas consumption measured by miles per gallon (mpg), number of cylinders (four, six or eight), transmission type (automatic or Manual) etc. In the mtcars dataset there are 11 features listed for each car. To shorten the list to few cars you want to test drive, you have chosen the **mpg** feature to compare the cars with. 

You could use the following three questions to help you select gas efficient car from the 32 cars in the sales lot.   
1/ You donâ€™t want to spend too much money on gas, so you want to know "which car has the maximum and which car has the minimum mpg for all the cars in the lot".  
2/ The cars on the lot have either 4, 6 or 8 cylinders. You want to know "what the average mpg for each cylinder group?"  
3/ Lastly, you want to know for each cylinder group "which cars are the most fuel efficient - the top 5%"   

Now that we have the question on hand, we are ready to examine the data and get the answers we are seeking. 

_It is assumed the reader has basic understanding of tyidyverse and/or R to follow the code in the scripts, but not required to follow and understand the process. [To learn on the tidyverse code go here](https://www.tidyverse.org/)_ 

## Importing and cleaning the data
On a typical analysis, getting, cleaning and transforming data takes up to 80% of the time. This is critical stage for any analysis, because without targeted quality data, the outcome is pretty much useless. The mtcars dataset is already in tidy format - it is already cleaned up and in a table with distinct rows and the same features assembled in each column.

Take a look at the data (scroll up/down to see all cars and features)
```{r carstable, warning=FALSE, message=FALSE, echo=FALSE}
library(kableExtra)

kable(mtcars) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"), full_width = F, position = "center") %>%
  row_spec(0, angle = -45) %>%
  scroll_box(width = "800px", height = "300px")
```
<br>

Although the matcars dataset is in tidy format and has no missing values to be concerned about, it is still row and requires further transformation to help answer the questions raised.  The dataset is relatively small, it contains 32 observations and 11 features. I used  _tidyverse_ and base R functions to get the data ready for analysis.

## Transform and Explore the data
Next we will transform the original mtcars dataset  using tidyverse and statistical functions.  As you will see the result of the transformation produces  4 datasets targeting each question raised earlier. The first dataset help us understand the impact of a car weight on mpg, and the other three target each of the three questions raised individually. _I will cover feature relationships and feature selection that helps us understand the data on another blog_ 

```{r transform, warning=FALSE, message=FALSE}
library(dplyr) #load the library for transofrorming data

# A. add the model name as a variaiable
df <- mtcars %>% 
      mutate(car_model = row.names(.))

# B. get the maximum and minimum mpg for all cars
mx_mpg  <- df %>% 
            slice(which.max(mpg), which.min(mpg)) %>%
            mutate_each(list(as.factor), cyl)

# C. Get the avg mpg for each cylinder type
avg_mpg <- df %>% 
            group_by(cyl) %>% 
            summarize(avg_wt = mean(wt), avg_mpg = mean(mpg)) %>% 
            mutate_each(list(as.factor), cyl) %>%
            mutate(note = paste0(round(avg_mpg), " mpg"))

# D. In each cyl group, cars whose mpg is in the top 5%
top_5 <- df %>% 
            group_by(cyl) %>% 
            filter(mpg > quantile(mpg, probs = .95)) %>%
            ungroup() %>% 
            mutate_each(list(as.factor), cyl)
```

The first dataset (A - df) simply adds the car model name as a feature. This is important because we want to use the car name to label to data points. The second dataset (B - mx_mpg) extracts the which cars have maximum and which cars have minimum mpg from all the cars. The third dataset (C - avt_mpg) calculates the average mpg for each cylinder group, the cars in the lot have either 4, 6 or 8 cylinders. And the last dataset (D - top_5) extracts the top 5% most efficient cars in each cylinder group.

As you can see in the code, I used dplyr verbs such as (gropu_by, summarize, mutate, filter) and statistical functions such (max, min, mean, quantile) and weaved them together to generate additional four new datasets that target the questions raised. This part of the analysis can be accomplished in many different ways and it is both an art and a science. But generally, it is good practice to brake question to small pieces instead of solving everything wholesale. 

## Lets us visualize the answers to the question
After importing, transforming and exploring the data, we want to visualize and communicate the result. We can generate reproducible summary documentation as a final repor including graphic plots to to visualize the answers. Visualizing they analysis result is a powerful tool in understanding the point of interest and, ath the same time,  gives point of reference to the entire data.

We are going to use the four datasets created earlier (df, mx_mpg, avg_mpg, top_5) to generate separate graphics plot that answer the questions raised. The graphics are rendered with one of the best tools for data visualization _grammar of graphic plot v2_ [ggplot2](https://ggplot2.tidyverse.org/). **ggplot2** is part of the _tidyverse_ family. 

#### A. Base plot - shows the impact of weight on mpg
```{r blog1Viz1 }
library(ggplot2)

gg <- ggplot(df, aes(x = wt, y = mpg)) +  
       geom_point() + 
       theme(legend.position=c(.85, .85))
gg
```


#### B. Answers the question - Which cars have maximum and minimum mpg from all the cars in the lot
```{r blog1Viz2 }
gg + 
  geom_point(data = mx_mpg, aes(x = wt, y = mpg, fill = cyl), shape=21, color="black", size=5, stroke=1) +            geom_text(data = mx_mpg, aes(label = car_model), size = 4.5, vjust = -.8, col = "blue") + 
  xlim(1, 6) + 
  ylim(10, 40)
```

#### C. Answers the question - what is the average mpg  for each cylinder group (4, 6, 8)
```{r blog1Viz3 }
gg + 
  geom_point(data = avg_mpg, aes(x = avg_wt, y = avg_mpg, fill = cyl), shape=21, color="black", size=5, stroke=1) + 
  geom_text(data =avg_mpg, aes(x = avg_wt, y = avg_mpg,label = note), size = 4.5, hjust = -.2, col = "blue")
```

#### D. Answers the question - What are the top 5% mpg cars for each cylinder group
```{r blog1Viz4 }
gg + 
  geom_point(data =top_5, aes(x = wt, y = mpg, fill = cyl), size = 4.5, shape=21, color="black", size=5, stroke=1) +   geom_text(data = top_5, aes(label = car_model), hjust = -.2, col = "blue")
```

## Summarizing the result of the analysis
It is clear from the graphic visualization that Toyota Corolla is the most fuel efficient car with 33.9 mpg, and Cadillac Fleetwood is the least efficient with at 10.4 mpg. It is also clear that the heavier the car is the higher the gas consumption. We can also see that, on average, the fewer the number of cylinders in a car, the higher more efficient in its fuel consumption.  **_Toyota Corolla_**, **_Hornet 4 Drive_** and **_Pontiac Firebird_** are in the top 5 percentile of each cylinder group. 

With this information on hand, you can make **data driven** decision and pick the  car to take for test drive.
  

## Take away  
On this blog, we took a row data, transform and applied statistics  to summarize and extract the answers to our questions. We generated plots to visualize the result. We focused on single feature (mpg) out of eleven, and small dataset to illustrate the data science process, and how to extract value we are seeking. **mtcars** data set is fairly small, however, the same process is applied for 'big-data' sets with had thousands or millions of features and observations! 

_Hope you enjoyed this first blog! Feel free to drop me an email <a href="mailto:abiyu.giday@datarecode.com%C2%A0" class="email">abiyu.giday@datarecode.com </a> or DM tweet me <a href="https://twitter.com/abiyugiday" class=twitter">@abiyugiday</a>, if you have any question or want to discuss further._

  </div>
</div>
<br>  
